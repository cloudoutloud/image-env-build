name: Delete GitHub Environment when PR is closed

on:
  pull_request:
    types: [ closed ]

jobs:
  delete-gh-environment:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      deployments: write

    steps:
    - name: Delete GitHub Environment
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        PR_NUMBER: ${{ github.event.pull_request.number }}
      run: |
        ENV_NAME="preview-${PR_NUMBER}"

        echo "Deleting github environment: ${ENV_NAME}"
        gh api repos/${{ github.repository }}/environments/${ENV_NAME} -X DELETE || echo "Environment not found or already deleted"

        echo "âœ“ GitHub Environment '${ENV_NAME}' deleted"
